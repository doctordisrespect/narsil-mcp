# Secret Detection Rules
# Detects hardcoded credentials, API keys, and other secrets

name: Secret Detection
version: "1.0.0"
description: Rules for detecting hardcoded secrets and credentials in code

rules:
  # Cloud Provider Keys
  - id: SECRET-001
    name: AWS Access Key
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'AKIA[0-9A-Z]{16}'
        - '(?i)aws_access_key_id\s*=\s*[''"]?AKIA[0-9A-Z]{16}'
      entropy_threshold: null
    languages: []
    message: AWS Access Key ID detected
    remediation: Remove the key, rotate it immediately, and use IAM roles or environment variables
    enabled: true
    tags: ["secrets", "aws"]

  - id: SECRET-002
    name: AWS Secret Key
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)aws_secret_access_key\s*=\s*[''"][A-Za-z0-9/+=]{40}[''"]'
      entropy_threshold: 4.0
    languages: []
    message: AWS Secret Access Key detected
    remediation: Remove and rotate immediately; use IAM roles or AWS Secrets Manager
    enabled: true
    tags: ["secrets", "aws"]

  - id: SECRET-003
    name: Google Cloud API Key
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'AIza[0-9A-Za-z\\-_]{35}'
      entropy_threshold: null
    languages: []
    message: Google Cloud API Key detected
    remediation: Remove the key, rotate it, and use service account credentials
    enabled: true
    tags: ["secrets", "gcp"]

  - id: SECRET-004
    name: Azure Storage Account Key
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)AccountKey\s*=\s*[A-Za-z0-9+/=]{88}'
      entropy_threshold: null
    languages: []
    message: Azure Storage Account Key detected
    remediation: Rotate the key and use Azure Key Vault or managed identities
    enabled: true
    tags: ["secrets", "azure"]

  # Version Control Tokens
  - id: SECRET-005
    name: GitHub Token
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'ghp_[0-9a-zA-Z]{36}'
        - 'gho_[0-9a-zA-Z]{36}'
        - 'ghu_[0-9a-zA-Z]{36}'
        - 'ghs_[0-9a-zA-Z]{36}'
        - 'ghr_[0-9a-zA-Z]{36}'
      entropy_threshold: null
    languages: []
    message: GitHub token detected
    remediation: Revoke the token immediately and use environment variables
    enabled: true
    tags: ["secrets", "github"]

  - id: SECRET-006
    name: GitLab Token
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'glpat-[0-9a-zA-Z\-\_]{20}'
        - 'gloas-[0-9a-zA-Z\-\_]{20}'
      entropy_threshold: null
    languages: []
    message: GitLab token detected
    remediation: Revoke and regenerate the token
    enabled: true
    tags: ["secrets", "gitlab"]

  # Communication Services
  - id: SECRET-007
    name: Slack Token
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'xox[baprs]-[0-9]{10,13}-[0-9]{10,13}[a-zA-Z0-9-]*'
        - 'xox.-[0-9]{12}-[0-9]{12}-[a-zA-Z0-9]{24}'
      entropy_threshold: null
    languages: []
    message: Slack token detected
    remediation: Revoke the token in Slack admin settings
    enabled: true
    tags: ["secrets", "slack"]

  - id: SECRET-008
    name: Discord Token
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '[MN][A-Za-z\d]{23,}\.[\w-]{6}\.[\w-]{27}'
      entropy_threshold: null
    languages: []
    message: Discord token detected
    remediation: Regenerate the Discord bot token immediately
    enabled: true
    tags: ["secrets", "discord"]

  - id: SECRET-009
    name: Twilio API Key
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'SK[0-9a-fA-F]{32}'
        - 'AC[0-9a-fA-F]{32}'
      entropy_threshold: null
    languages: []
    message: Twilio API key detected
    remediation: Rotate the Twilio API key
    enabled: true
    tags: ["secrets", "twilio"]

  # Payment Providers
  - id: SECRET-010
    name: Stripe API Key
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'sk_live_[0-9a-zA-Z]{24}'
        - 'rk_live_[0-9a-zA-Z]{24}'
        - 'sk_test_[0-9a-zA-Z]{24}'
      entropy_threshold: null
    languages: []
    message: Stripe API key detected
    remediation: Roll the API key immediately in Stripe dashboard
    enabled: true
    tags: ["secrets", "stripe", "payment"]

  - id: SECRET-011
    name: PayPal/Braintree Token
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'access_token\$production\$[0-9a-z]{16}\$[0-9a-f]{32}'
        - 'sandbox_[0-9a-z]{32}'
      entropy_threshold: null
    languages: []
    message: PayPal/Braintree token detected
    remediation: Regenerate the access token
    enabled: true
    tags: ["secrets", "paypal", "payment"]

  # Database Credentials
  - id: SECRET-012
    name: Database Connection String
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'mongodb\+srv://[^:]+:[^@]+@'
        - 'postgres://[^:]+:[^@]+@'
        - 'mysql://[^:]+:[^@]+@'
        - 'redis://:[^@]+@'
        - 'amqp://[^:]+:[^@]+@'
      entropy_threshold: null
    languages: []
    message: Database connection string with credentials detected
    remediation: Use environment variables or secrets management for database credentials
    enabled: true
    tags: ["secrets", "database"]

  # Cryptographic Keys
  - id: SECRET-013
    name: Private Key - RSA
    severity: Critical
    cwe: ["CWE-321"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '-----BEGIN RSA PRIVATE KEY-----'
        - '-----BEGIN PRIVATE KEY-----'
        - '-----BEGIN EC PRIVATE KEY-----'
        - '-----BEGIN OPENSSH PRIVATE KEY-----'
        - '-----BEGIN DSA PRIVATE KEY-----'
      entropy_threshold: null
    languages: []
    message: Private key detected in code
    remediation: Never commit private keys; use secure key management systems
    enabled: true
    tags: ["secrets", "crypto"]

  - id: SECRET-014
    name: PGP Private Key
    severity: Critical
    cwe: ["CWE-321"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '-----BEGIN PGP PRIVATE KEY BLOCK-----'
      entropy_threshold: null
    languages: []
    message: PGP private key detected
    remediation: Remove and revoke the key; use proper key management
    enabled: true
    tags: ["secrets", "crypto"]

  # API Keys (Generic)
  - id: SECRET-015
    name: Generic API Key
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)api[_-]?key\s*[=:]\s*[''"]([a-zA-Z0-9]{32,})[''"]'
        - '(?i)apikey\s*[=:]\s*[''"]([a-zA-Z0-9]{32,})[''"]'
        - '(?i)x-api-key\s*[=:]\s*[''"]([a-zA-Z0-9]{32,})[''"]'
      entropy_threshold: 4.0
    languages: []
    message: Potential API key detected
    remediation: Move API keys to environment variables or secrets management
    enabled: true
    tags: ["secrets", "api"]

  - id: SECRET-016
    name: Bearer Token
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)bearer\s+[a-zA-Z0-9\-_\.]{20,}'
        - '(?i)authorization\s*[=:]\s*[''"]Bearer\s+[a-zA-Z0-9\-_\.]{20,}'
      entropy_threshold: 3.5
    languages: []
    message: Bearer token detected
    remediation: Use environment variables for authentication tokens
    enabled: true
    tags: ["secrets", "auth"]

  # Authentication Secrets
  - id: SECRET-017
    name: JWT Secret
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)jwt[_-]?secret\s*[=:]\s*[''"]([^''"]{16,})[''"]'
        - '(?i)jwt[_-]?key\s*[=:]\s*[''"]([^''"]{16,})[''"]'
      entropy_threshold: 3.5
    languages: []
    message: JWT secret detected
    remediation: Use environment variables; ensure secrets are 256+ bits
    enabled: true
    tags: ["secrets", "jwt"]

  - id: SECRET-018
    name: Session Secret
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)session[_-]?secret\s*[=:]\s*[''"]([^''"]{8,})[''"]'
        - '(?i)secret[_-]?key\s*[=:]\s*[''"]([^''"]{8,})[''"]'
        - '(?i)cookie[_-]?secret\s*[=:]\s*[''"]([^''"]{8,})[''"]'
      entropy_threshold: 3.5
    languages: []
    message: Session/cookie secret detected
    remediation: Use environment variables for session secrets
    enabled: true
    tags: ["secrets", "session"]

  - id: SECRET-019
    name: Hardcoded Password
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)password\s*=\s*[''"][^''"]{8,}[''"]'
        - '(?i)passwd\s*=\s*[''"][^''"]{8,}[''"]'
        - '(?i)pwd\s*=\s*[''"][^''"]{8,}[''"]'
      entropy_threshold: 3.0
    languages: []
    message: Hardcoded password detected
    remediation: Never hardcode passwords; use environment variables or secrets management
    enabled: true
    tags: ["secrets", "password"]

  # Service-Specific Keys
  - id: SECRET-020
    name: SendGrid API Key
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'SG\.[a-zA-Z0-9]{22}\.[a-zA-Z0-9]{43}'
      entropy_threshold: null
    languages: []
    message: SendGrid API key detected
    remediation: Rotate the SendGrid API key
    enabled: true
    tags: ["secrets", "sendgrid", "email"]

  - id: SECRET-021
    name: Mailchimp API Key
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '[0-9a-f]{32}-us[0-9]{1,2}'
      entropy_threshold: null
    languages: []
    message: Mailchimp API key detected
    remediation: Regenerate the Mailchimp API key
    enabled: true
    tags: ["secrets", "mailchimp", "email"]

  - id: SECRET-022
    name: Firebase Database Secret
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)firebase[^=]*=\s*[''"][a-zA-Z0-9]{40}[''"]'
      entropy_threshold: null
    languages: []
    message: Firebase database secret detected
    remediation: Use Firebase security rules and service accounts
    enabled: true
    tags: ["secrets", "firebase"]

  - id: SECRET-023
    name: Heroku API Key
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)heroku.*[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}'
      entropy_threshold: null
    languages: []
    message: Heroku API key detected
    remediation: Regenerate the Heroku API key
    enabled: true
    tags: ["secrets", "heroku"]

  # Social Media Keys
  - id: SECRET-024
    name: Twitter API Key
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)twitter[_-]?(api[_-]?)?key\s*=\s*[''"][a-zA-Z0-9]{25}[''"]'
        - '(?i)twitter[_-]?(api[_-]?)?secret\s*=\s*[''"][a-zA-Z0-9]{50}[''"]'
      entropy_threshold: null
    languages: []
    message: Twitter API credentials detected
    remediation: Regenerate Twitter API credentials
    enabled: true
    tags: ["secrets", "twitter"]

  - id: SECRET-025
    name: Facebook Token
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - 'EAACEdEose0cBA[0-9A-Za-z]+'
      entropy_threshold: null
    languages: []
    message: Facebook access token detected
    remediation: Invalidate the token and regenerate
    enabled: true
    tags: ["secrets", "facebook"]
