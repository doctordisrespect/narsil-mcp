# OWASP Top 10 2021 Security Rules
# https://owasp.org/Top10/

name: OWASP Top 10 2021
version: "1.0.0"
description: Security rules covering OWASP Top 10 2021 vulnerabilities

rules:
  # A01:2021 - Broken Access Control
  - id: OWASP-A01-001
    name: Missing Authorization Check
    severity: High
    cwe: ["CWE-862", "CWE-863"]
    owasp: ["A01:2021"]
    rule_type:
      type: pattern
      patterns:
        - '@app\.route.*\n(?:(?!@login_required|@auth\.required|@requires_auth).)*.def'
        - 'router\.(get|post|put|delete)\([^)]+\)(?!\.middleware)'
      safe_patterns:
        - '@login_required'
        - '@auth_required'
        - '\.middleware\(auth'
    languages: ["python", "javascript", "typescript"]
    message: Route handler may be missing authorization check
    remediation: Add authentication/authorization middleware or decorator to protect this endpoint
    enabled: true
    tags: ["auth", "access-control"]

  - id: OWASP-A01-002
    name: Direct Object Reference
    severity: High
    cwe: ["CWE-639"]
    owasp: ["A01:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'User\.objects\.get\(id\s*=\s*request\.'
        - 'findById\(req\.params\.'
        - 'WHERE\s+id\s*=.*request\.'
      safe_patterns:
        - 'request\.user\.id'
        - 'current_user\.id'
    languages: ["python", "javascript"]
    message: Direct object reference without ownership check
    remediation: Verify that the current user has permission to access the requested resource
    enabled: true
    tags: ["auth", "idor"]

  # A02:2021 - Cryptographic Failures
  - id: OWASP-A02-001
    name: Weak Cryptographic Algorithm
    severity: High
    cwe: ["CWE-327", "CWE-328"]
    owasp: ["A02:2021"]
    rule_type:
      type: crypto
      weak_algorithms: ["MD5", "SHA1", "DES", "3DES", "RC4", "RC2"]
      insecure_modes: ["ECB"]
      min_key_size: 128
    languages: []
    message: Use of weak cryptographic algorithm detected
    remediation: Use strong algorithms like SHA-256, SHA-512, AES-256, or ChaCha20
    enabled: true
    tags: ["crypto"]

  - id: OWASP-A02-002
    name: Sensitive Data Exposure
    severity: High
    cwe: ["CWE-311", "CWE-319"]
    owasp: ["A02:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'http://'
        - 'verify\s*=\s*False'
        - 'rejectUnauthorized\s*:\s*false'
      safe_patterns:
        - 'http://localhost'
        - 'http://127.0.0.1'
    languages: []
    message: Potential insecure data transmission
    remediation: Use HTTPS and enable certificate verification
    enabled: true
    tags: ["crypto", "transport"]

  # A03:2021 - Injection
  - id: OWASP-A03-001
    name: SQL Injection
    severity: Critical
    cwe: ["CWE-89"]
    owasp: ["A03:2021"]
    rule_type:
      type: taint_flow
      sources:
        - "request.args"
        - "request.form"
        - "req.query"
        - "req.body"
        - "req.params"
      sinks:
        - "execute"
        - "query"
        - "raw"
        - "cursor"
      sanitizers:
        - "parameterized"
        - "prepared"
        - "escape"
    languages: []
    message: Potential SQL injection vulnerability
    remediation: Use parameterized queries or prepared statements instead of string concatenation
    enabled: true
    tags: ["injection", "sql"]

  - id: OWASP-A03-002
    name: Command Injection
    severity: Critical
    cwe: ["CWE-78"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'subprocess\.(?:call|run|Popen)\([^)]*shell\s*=\s*True'
        - 'os\.system\([^)]*\+'
        - 'exec\([^)]*\+'
        - 'child_process\.exec\([^)]*\+'
        - 'eval\([^)]*\+'
      safe_patterns:
        - 'shlex\.quote'
        - 'escapeshellarg'
    languages: ["python", "javascript"]
    message: Potential command injection vulnerability
    remediation: Avoid shell=True, use subprocess with list arguments, and sanitize all inputs
    enabled: true
    tags: ["injection", "command"]

  - id: OWASP-A03-003
    name: Cross-Site Scripting (XSS)
    severity: High
    cwe: ["CWE-79"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'innerHTML\s*='
        - 'document\.write\('
        - 'v-html\s*='
        - 'dangerouslySetInnerHTML'
        - '\|safe\}'
        - '{{ .* \| safe }}'
      safe_patterns:
        - 'DOMPurify\.sanitize'
        - 'escapeHtml'
        - 'encode'
    languages: ["javascript", "typescript"]
    message: Potential XSS vulnerability from unsanitized HTML output
    remediation: Sanitize user input using DOMPurify or similar library before inserting into DOM
    enabled: true
    tags: ["injection", "xss"]

  # A04:2021 - Insecure Design
  - id: OWASP-A04-001
    name: Debug Mode Enabled
    severity: Medium
    cwe: ["CWE-489"]
    owasp: ["A04:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'DEBUG\s*=\s*True'
        - 'app\.debug\s*=\s*True'
        - '"debug":\s*true'
        - 'NODE_ENV.*development'
      safe_patterns: []
    languages: ["python", "javascript"]
    message: Debug mode appears to be enabled
    remediation: Disable debug mode in production environments
    enabled: true
    tags: ["config"]

  # A05:2021 - Security Misconfiguration
  - id: OWASP-A05-001
    name: CORS Misconfiguration
    severity: Medium
    cwe: ["CWE-942"]
    owasp: ["A05:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'Access-Control-Allow-Origin.*\*'
        - 'cors\(\s*\)'
        - 'origin:\s*true'
        - 'CORS_ALLOW_ALL_ORIGINS\s*=\s*True'
      safe_patterns: []
    languages: []
    message: Overly permissive CORS configuration
    remediation: Restrict CORS to specific trusted origins instead of allowing all origins
    enabled: true
    tags: ["cors", "config"]

  - id: OWASP-A05-002
    name: Security Headers Missing
    severity: Low
    cwe: ["CWE-693"]
    owasp: ["A05:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'Content-Security-Policy.*unsafe'
        - 'X-Frame-Options.*allow'
      safe_patterns: []
    languages: []
    message: Security headers may be misconfigured
    remediation: Configure proper security headers (CSP, X-Frame-Options, etc.)
    enabled: true
    tags: ["headers", "config"]

  # A07:2021 - Identification and Authentication Failures
  - id: OWASP-A07-001
    name: Hardcoded Credentials
    severity: Critical
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: secret
      patterns:
        - '(?i)password\s*=\s*[''"][^''"]{8,}[''"]'
        - '(?i)api_?key\s*=\s*[''"][^''"]{16,}[''"]'
        - '(?i)secret\s*=\s*[''"][^''"]{8,}[''"]'
        - '(?i)token\s*=\s*[''"][^''"]{16,}[''"]'
      entropy_threshold: 3.5
    languages: []
    message: Hardcoded credential detected
    remediation: Move credentials to environment variables or secure secrets management
    enabled: true
    tags: ["secrets", "credentials"]

  - id: OWASP-A07-002
    name: Weak Password Requirements
    severity: Medium
    cwe: ["CWE-521"]
    owasp: ["A07:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'min_?length\s*[=:]\s*[1-7]\b'
        - 'minLength\s*[=:]\s*[1-7]\b'
      safe_patterns: []
    languages: []
    message: Password minimum length requirement appears too short
    remediation: Require passwords of at least 8 characters, preferably 12+
    enabled: true
    tags: ["auth", "password"]

  # A08:2021 - Software and Data Integrity Failures
  - id: OWASP-A08-001
    name: Insecure Deserialization
    severity: Critical
    cwe: ["CWE-502"]
    owasp: ["A08:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'pickle\.loads?\('
        - 'yaml\.load\([^)]*Loader\s*=\s*yaml\.Loader'
        - 'yaml\.unsafe_load'
        - 'Marshal\.load'
        - 'unserialize\('
        - 'JSON\.parse.*eval'
      safe_patterns:
        - 'yaml\.safe_load'
    languages: ["python", "ruby", "php"]
    message: Insecure deserialization detected
    remediation: Use safe deserialization methods and validate input before deserializing
    enabled: true
    tags: ["deserialization"]

  # A09:2021 - Security Logging and Monitoring Failures
  - id: OWASP-A09-001
    name: Sensitive Data in Logs
    severity: Medium
    cwe: ["CWE-532"]
    owasp: ["A09:2021"]
    rule_type:
      type: pattern
      patterns:
        - '(?i)log.*password'
        - '(?i)print.*password'
        - '(?i)console\.log.*password'
        - '(?i)log.*credit.?card'
        - '(?i)log.*ssn'
      safe_patterns: []
    languages: []
    message: Potential sensitive data being logged
    remediation: Remove sensitive data from logs or mask it appropriately
    enabled: true
    tags: ["logging", "privacy"]

  # A10:2021 - Server-Side Request Forgery
  - id: OWASP-A10-001
    name: Server-Side Request Forgery
    severity: High
    cwe: ["CWE-918"]
    owasp: ["A10:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'requests\.(get|post|put|delete)\([^)]*request\.(args|form|data)'
        - 'urllib\.request\.urlopen\([^)]*request'
        - 'fetch\([^)]*req\.(query|body|params)'
        - 'http\.request\([^)]*req\.'
      safe_patterns:
        - 'validate_url'
        - 'allowed_hosts'
    languages: ["python", "javascript", "typescript"]
    message: Potential SSRF vulnerability - user input used in URL
    remediation: Validate and whitelist allowed URLs/hosts before making requests
    enabled: true
    tags: ["ssrf", "network"]

  # Go-specific security rules

  # Go: SQL Injection
  - id: GO-001
    name: Go SQL Injection
    severity: Critical
    cwe: ["CWE-89"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'db\.Query\([^,]*\+\s*'
        - 'db\.Exec\([^,]*\+\s*'
        - 'fmt\.Sprintf.*SELECT.*%s'
        - 'fmt\.Sprintf.*INSERT.*%s'
        - 'fmt\.Sprintf.*UPDATE.*%s'
        - 'fmt\.Sprintf.*DELETE.*%s'
      safe_patterns:
        - 'db\.Query\([^,]+,\s*'
        - 'db\.Exec\([^,]+,\s*'
        - 'Prepare\('
        - 'squirrel'
        - 'sqlx'
    languages: ["go"]
    message: Potential SQL injection in Go - string concatenation in query
    remediation: Use parameterized queries with ? or $1 placeholders
    enabled: true
    tags: ["injection", "sql"]

  # Go: Insecure TLS Configuration
  - id: GO-002
    name: Go Insecure TLS
    severity: High
    cwe: ["CWE-295"]
    owasp: ["A02:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'InsecureSkipVerify:\s*true'
        - 'MinVersion:\s*tls\.VersionSSL'
        - 'MinVersion:\s*tls\.VersionTLS10'
        - 'MinVersion:\s*tls\.VersionTLS11'
      safe_patterns:
        - 'MinVersion:\s*tls\.VersionTLS12'
        - 'MinVersion:\s*tls\.VersionTLS13'
    languages: ["go"]
    message: Insecure TLS configuration in Go
    remediation: Set InsecureSkipVerify to false and use TLS 1.2+ minimum
    enabled: true
    tags: ["crypto", "tls"]

  # Go: Command Injection
  - id: GO-003
    name: Go Command Injection
    severity: Critical
    cwe: ["CWE-78"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'exec\.Command\([^,]*\+\s*'
        - 'exec\.CommandContext\([^,]*\+\s*'
        - 'os/exec.*Command\(.*fmt\.Sprintf'
      safe_patterns:
        - 'exec\.Command\([^,]+,\s*args\.\.\.'
        - 'shellquote'
    languages: ["go"]
    message: Potential command injection in Go
    remediation: Avoid string concatenation in commands; use separate arguments
    enabled: true
    tags: ["injection", "command"]

  # Go: Path Traversal
  - id: GO-004
    name: Go Path Traversal
    severity: High
    cwe: ["CWE-22"]
    owasp: ["A01:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'filepath\.Join\([^)]*r\.URL'
        - 'os\.Open\([^)]*r\.FormValue'
        - 'ioutil\.ReadFile\([^)]*r\.URL'
        - 'http\.ServeFile\([^)]*r\.URL'
      safe_patterns:
        - 'filepath\.Clean'
        - 'filepath\.Rel'
        - 'strings\.HasPrefix'
    languages: ["go"]
    message: Potential path traversal in Go - user input in file path
    remediation: Use filepath.Clean and validate paths stay within allowed directory
    enabled: true
    tags: ["path", "filesystem"]

  # Go: Weak Crypto
  - id: GO-005
    name: Go Weak Cryptography
    severity: High
    cwe: ["CWE-327", "CWE-328"]
    owasp: ["A02:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'crypto/md5'
        - 'crypto/sha1'
        - 'crypto/des'
        - 'crypto/rc4'
        - 'md5\.New\('
        - 'sha1\.New\('
      safe_patterns:
        - 'crypto/sha256'
        - 'crypto/sha512'
        - 'golang\.org/x/crypto'
    languages: ["go"]
    message: Use of weak cryptographic algorithm in Go
    remediation: Use SHA-256, SHA-512, or algorithms from golang.org/x/crypto
    enabled: true
    tags: ["crypto"]

  # Java-specific security rules

  # Java: SQL Injection
  - id: JAVA-001
    name: Java SQL Injection
    severity: Critical
    cwe: ["CWE-89"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'createQuery\([^)]*\+\s*'
        - 'executeQuery\([^)]*\+\s*'
        - 'Statement.*execute.*\+\s*'
        - '"SELECT.*"\s*\+\s*'
        - '"INSERT.*"\s*\+\s*'
      safe_patterns:
        - 'PreparedStatement'
        - 'setString'
        - 'setInt'
        - 'createNamedQuery'
    languages: ["java"]
    message: Potential SQL injection in Java - string concatenation in query
    remediation: Use PreparedStatement with parameterized queries
    enabled: true
    tags: ["injection", "sql"]

  # Java: XXE
  - id: JAVA-002
    name: Java XXE Vulnerability
    severity: High
    cwe: ["CWE-611"]
    owasp: ["A05:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'DocumentBuilderFactory\.newInstance\(\)'
        - 'SAXParserFactory\.newInstance\(\)'
        - 'XMLInputFactory\.newInstance\(\)'
      safe_patterns:
        - 'setFeature.*XMLConstants\.FEATURE_SECURE_PROCESSING'
        - 'setFeature.*disallow-doctype-decl'
        - 'setExpandEntityReferences\(false\)'
    languages: ["java"]
    message: XML parser may be vulnerable to XXE attacks
    remediation: Disable external entity processing in XML parsers
    enabled: true
    tags: ["xxe", "injection"]

  # Java: Insecure Deserialization
  - id: JAVA-003
    name: Java Insecure Deserialization
    severity: Critical
    cwe: ["CWE-502"]
    owasp: ["A08:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'ObjectInputStream'
        - 'readObject\(\)'
        - 'XMLDecoder'
        - 'XStream\.fromXML'
      safe_patterns:
        - 'ObjectInputFilter'
        - 'serialFilter'
        - 'allowedClasses'
    languages: ["java"]
    message: Potential insecure deserialization in Java
    remediation: Use ObjectInputFilter to validate classes during deserialization
    enabled: true
    tags: ["deserialization"]

  # Java: Path Traversal
  - id: JAVA-004
    name: Java Path Traversal
    severity: High
    cwe: ["CWE-22"]
    owasp: ["A01:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'new File\([^)]*request\.getParameter'
        - 'Paths\.get\([^)]*request\.'
        - 'Files\.readAllBytes\([^)]*request\.'
      safe_patterns:
        - 'getCanonicalPath'
        - 'normalize\(\)'
        - 'startsWith'
    languages: ["java"]
    message: Potential path traversal in Java
    remediation: Use getCanonicalPath() and validate paths stay within allowed directory
    enabled: true
    tags: ["path", "filesystem"]

  # Java: LDAP Injection
  - id: JAVA-005
    name: Java LDAP Injection
    severity: High
    cwe: ["CWE-90"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'ctx\.search\([^)]*\+\s*'
        - 'DirContext.*search.*\+\s*'
        - '"\\(.*="\s*\+\s*'
      safe_patterns:
        - 'encodeForLDAP'
        - 'escapeLdap'
    languages: ["java"]
    message: Potential LDAP injection in Java
    remediation: Escape special LDAP characters in user input
    enabled: true
    tags: ["injection", "ldap"]

  # C#-specific security rules

  # C#: SQL Injection
  - id: CSHARP-001
    name: C# SQL Injection
    severity: Critical
    cwe: ["CWE-89"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'SqlCommand\([^)]*\+\s*'
        - 'ExecuteReader\([^)]*\+\s*'
        - 'ExecuteNonQuery\([^)]*\+\s*'
        - '"SELECT.*"\s*\+\s*'
        - 'FromSqlRaw\([^)]*\+\s*'
      safe_patterns:
        - 'SqlParameter'
        - 'AddWithValue'
        - 'FromSqlInterpolated'
    languages: ["csharp"]
    message: Potential SQL injection in C# - string concatenation in query
    remediation: Use parameterized queries with SqlParameter
    enabled: true
    tags: ["injection", "sql"]

  # C#: Insecure Deserialization
  - id: CSHARP-002
    name: C# Insecure Deserialization
    severity: Critical
    cwe: ["CWE-502"]
    owasp: ["A08:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'BinaryFormatter'
        - 'Deserialize\('
        - 'JsonConvert\.DeserializeObject\('
        - 'XmlSerializer\([^)]*typeof'
      safe_patterns:
        - 'JsonSerializerOptions'
        - 'TypeNameHandling\.None'
    languages: ["csharp"]
    message: Potential insecure deserialization in C#
    remediation: Avoid BinaryFormatter; use safe serializers with type validation
    enabled: true
    tags: ["deserialization"]

  # C#: XSS via Razor
  - id: CSHARP-003
    name: C# XSS Vulnerability
    severity: High
    cwe: ["CWE-79"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - '@Html\.Raw\('
        - 'HtmlString\('
        - 'Response\.Write\('
      safe_patterns:
        - 'HtmlEncode'
        - 'AntiXss'
        - '@Html\.Encode'
    languages: ["csharp"]
    message: Potential XSS vulnerability in C#
    remediation: Use Html.Encode or avoid Html.Raw with user input
    enabled: true
    tags: ["xss", "injection"]

  # C#: Path Traversal
  - id: CSHARP-004
    name: C# Path Traversal
    severity: High
    cwe: ["CWE-22"]
    owasp: ["A01:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'Path\.Combine\([^)]*Request\.'
        - 'File\.ReadAllText\([^)]*Request\.'
        - 'Directory\.GetFiles\([^)]*Request\.'
      safe_patterns:
        - 'Path\.GetFullPath'
        - 'StartsWith'
    languages: ["csharp"]
    message: Potential path traversal in C#
    remediation: Use Path.GetFullPath and validate paths stay within allowed directory
    enabled: true
    tags: ["path", "filesystem"]

  # C#: LDAP Injection
  - id: CSHARP-005
    name: C# LDAP Injection
    severity: High
    cwe: ["CWE-90"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'DirectorySearcher.*Filter.*\+\s*'
        - '"\\(.*="\s*\+\s*'
      safe_patterns:
        - 'EscapeLdapFilterValue'
    languages: ["csharp"]
    message: Potential LDAP injection in C#
    remediation: Escape special LDAP characters in user input
    enabled: true
    tags: ["injection", "ldap"]

  # Ruby-specific security rules

  # Ruby: SQL Injection
  - id: RUBY-001
    name: Ruby SQL Injection
    severity: Critical
    cwe: ["CWE-89"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'where\([^)]*#\{'
        - 'find_by_sql\([^)]*#\{'
        - 'execute\([^)]*#\{'
        - 'select_all\([^)]*#\{'
      safe_patterns:
        - 'where\([^)]*,\s*'
        - 'sanitize'
        - 'quote'
    languages: ["ruby"]
    message: Potential SQL injection in Ruby - string interpolation in query
    remediation: Use parameterized queries with placeholders
    enabled: true
    tags: ["injection", "sql"]

  # Ruby: Command Injection
  - id: RUBY-002
    name: Ruby Command Injection
    severity: Critical
    cwe: ["CWE-78"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'system\([^)]*#\{'
        - '`[^`]*#\{'
        - 'exec\([^)]*#\{'
        - 'Open3\.'
      safe_patterns:
        - 'Shellwords\.escape'
        - 'shellescape'
    languages: ["ruby"]
    message: Potential command injection in Ruby
    remediation: Use Shellwords.escape for shell arguments
    enabled: true
    tags: ["injection", "command"]

  # Ruby: Mass Assignment
  - id: RUBY-003
    name: Ruby Mass Assignment
    severity: High
    cwe: ["CWE-915"]
    owasp: ["A04:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'attr_accessible\s*$'
        - 'params\.permit!'
        - '\.update\(params\['
        - '\.create\(params\['
      safe_patterns:
        - 'strong_parameters'
        - '\.permit\('
    languages: ["ruby"]
    message: Potential mass assignment vulnerability in Ruby
    remediation: Use strong parameters with explicit permit list
    enabled: true
    tags: ["mass-assignment"]

  # Ruby: Open Redirect
  - id: RUBY-004
    name: Ruby Open Redirect
    severity: Medium
    cwe: ["CWE-601"]
    owasp: ["A01:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'redirect_to\s+params\['
        - 'redirect_to\s+request\.'
      safe_patterns:
        - 'redirect_to.*only_path:\s*true'
        - 'URI\.parse.*host'
    languages: ["ruby"]
    message: Potential open redirect vulnerability in Ruby
    remediation: Validate redirect URLs against a whitelist
    enabled: true
    tags: ["redirect"]

  # Ruby: ERB XSS
  - id: RUBY-005
    name: Ruby ERB XSS
    severity: High
    cwe: ["CWE-79"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - '<%=\s*raw\s'
        - '\.html_safe'
        - 'content_tag.*html_safe'
      safe_patterns:
        - 'sanitize'
        - 'ERB::Util\.html_escape'
    languages: ["ruby"]
    message: Potential XSS vulnerability in Ruby ERB
    remediation: Avoid raw/html_safe with user input; use sanitize
    enabled: true
    tags: ["xss", "injection"]

  # Kotlin-specific security rules

  # Kotlin: SQL Injection
  - id: KOTLIN-001
    name: Kotlin SQL Injection
    severity: Critical
    cwe: ["CWE-89"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'createQuery\([^)]*\+\s*'
        - 'rawQuery\([^)]*\$'
        - '"SELECT.*"\s*\+\s*'
        - '"SELECT.*\$\{'
      safe_patterns:
        - 'PreparedStatement'
        - 'setString'
        - 'parameterized'
    languages: ["kotlin"]
    message: Potential SQL injection in Kotlin
    remediation: Use parameterized queries
    enabled: true
    tags: ["injection", "sql"]

  # Kotlin: Android WebView JavaScript
  - id: KOTLIN-002
    name: Kotlin WebView JavaScript Enabled
    severity: High
    cwe: ["CWE-79"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'setJavaScriptEnabled\(true\)'
        - 'addJavascriptInterface'
      safe_patterns:
        - 'WebViewClient'
        - 'shouldOverrideUrlLoading'
    languages: ["kotlin"]
    message: WebView JavaScript enabled - potential XSS risk
    remediation: Be cautious with JavaScript in WebView; validate loaded URLs
    enabled: true
    tags: ["android", "xss"]

  # Kotlin: Insecure Intent
  - id: KOTLIN-003
    name: Kotlin Insecure Intent
    severity: Medium
    cwe: ["CWE-926"]
    owasp: ["A04:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'getIntent\(\)\.getStringExtra'
        - 'intent\.data\?'
        - 'PendingIntent.*FLAG_MUTABLE'
      safe_patterns:
        - 'FLAG_IMMUTABLE'
        - 'exported\s*=\s*false'
    languages: ["kotlin"]
    message: Potential insecure intent handling in Kotlin
    remediation: Validate intent data and use FLAG_IMMUTABLE for PendingIntents
    enabled: true
    tags: ["android", "intent"]

  # Kotlin: Hardcoded Secrets
  - id: KOTLIN-004
    name: Kotlin Hardcoded Secret
    severity: High
    cwe: ["CWE-798"]
    owasp: ["A07:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'val\s+\w*[Kk]ey\w*\s*=\s*"[^"]{16,}'
        - 'val\s+\w*[Ss]ecret\w*\s*=\s*"[^"]{8,}'
        - 'val\s+\w*[Pp]assword\w*\s*=\s*"[^"]+'
      safe_patterns:
        - 'BuildConfig'
        - 'getProperty'
        - 'environment'
    languages: ["kotlin"]
    message: Potential hardcoded secret in Kotlin
    remediation: Store secrets in environment variables or secure storage
    enabled: true
    tags: ["secrets"]

  # Kotlin: Insecure Random
  - id: KOTLIN-005
    name: Kotlin Insecure Random
    severity: Medium
    cwe: ["CWE-330"]
    owasp: ["A02:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'Random\(\)'
        - 'java\.util\.Random'
        - 'kotlin\.random\.Random'
      safe_patterns:
        - 'SecureRandom'
    languages: ["kotlin"]
    message: Use of insecure random number generator in Kotlin
    remediation: Use SecureRandom for security-sensitive operations
    enabled: true
    tags: ["crypto", "random"]

  # PHP-specific security rules

  # PHP: SQL Injection
  - id: PHP-001
    name: PHP SQL Injection
    severity: Critical
    cwe: ["CWE-89"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'mysql_query\([^)]*\.\s*\$'
        - 'mysqli_query\([^)]*\.\s*\$'
        - '\$pdo->query\([^)]*\.\s*\$'
        - '"SELECT.*"\s*\.\s*\$'
      safe_patterns:
        - 'prepare'
        - 'bindParam'
        - 'bindValue'
        - 'PDO::PARAM'
    languages: ["php"]
    message: Potential SQL injection in PHP
    remediation: Use PDO prepared statements with parameterized queries
    enabled: true
    tags: ["injection", "sql"]

  # PHP: Command Injection
  - id: PHP-002
    name: PHP Command Injection
    severity: Critical
    cwe: ["CWE-78"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'exec\([^)]*\$'
        - 'shell_exec\([^)]*\$'
        - 'system\([^)]*\$'
        - 'passthru\([^)]*\$'
        - '`[^`]*\$'
      safe_patterns:
        - 'escapeshellarg'
        - 'escapeshellcmd'
    languages: ["php"]
    message: Potential command injection in PHP
    remediation: Use escapeshellarg for shell arguments
    enabled: true
    tags: ["injection", "command"]

  # PHP: File Inclusion
  - id: PHP-003
    name: PHP File Inclusion
    severity: Critical
    cwe: ["CWE-98"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'include\([^)]*\$'
        - 'include_once\([^)]*\$'
        - 'require\([^)]*\$'
        - 'require_once\([^)]*\$'
      safe_patterns:
        - 'basename'
        - 'realpath'
        - 'in_array'
    languages: ["php"]
    message: Potential file inclusion vulnerability in PHP
    remediation: Use a whitelist of allowed files instead of user input
    enabled: true
    tags: ["inclusion", "filesystem"]

  # PHP: Unserialize
  - id: PHP-004
    name: PHP Insecure Unserialize
    severity: Critical
    cwe: ["CWE-502"]
    owasp: ["A08:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'unserialize\([^)]*\$'
        - 'unserialize\(\$_'
      safe_patterns:
        - 'json_decode'
        - 'allowed_classes'
    languages: ["php"]
    message: Potential insecure deserialization in PHP
    remediation: Use json_decode instead of unserialize with user input
    enabled: true
    tags: ["deserialization"]

  # PHP: XSS
  - id: PHP-005
    name: PHP XSS Vulnerability
    severity: High
    cwe: ["CWE-79"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'echo\s+\$_'
        - 'print\s+\$_'
        - '<?=\s*\$_'
      safe_patterns:
        - 'htmlspecialchars'
        - 'htmlentities'
        - 'strip_tags'
    languages: ["php"]
    message: Potential XSS vulnerability in PHP
    remediation: Use htmlspecialchars for output encoding
    enabled: true
    tags: ["xss", "injection"]

  # PHP: Path Traversal
  - id: PHP-006
    name: PHP Path Traversal
    severity: High
    cwe: ["CWE-22"]
    owasp: ["A01:2021"]
    rule_type:
      type: pattern
      patterns:
        - 'file_get_contents\([^)]*\$_'
        - 'fopen\([^)]*\$_'
        - 'readfile\([^)]*\$_'
      safe_patterns:
        - 'basename'
        - 'realpath'
    languages: ["php"]
    message: Potential path traversal in PHP
    remediation: Use basename and realpath to validate file paths
    enabled: true
    tags: ["path", "filesystem"]

  # TypeScript-specific security rules

  # TypeScript: Any type usage
  - id: TS-001
    name: TypeScript Any Type Usage
    severity: Low
    cwe: ["CWE-20"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - ':\s*any\b'
        - '<any>'
        - 'as\s+any'
      safe_patterns:
        - 'unknown'
        - 'never'
    languages: ["typescript"]
    message: Use of 'any' type bypasses type safety
    remediation: Use specific types or 'unknown' instead of 'any'
    enabled: true
    tags: ["type-safety"]

  # TypeScript: Non-null assertion
  - id: TS-002
    name: TypeScript Non-null Assertion
    severity: Low
    cwe: ["CWE-476"]
    owasp: ["A03:2021"]
    rule_type:
      type: pattern
      patterns:
        - '\w+!\.'
        - '\w+!\['
      safe_patterns:
        - '\?\.'
        - '\?\['
    languages: ["typescript"]
    message: Non-null assertion may cause runtime errors
    remediation: Use optional chaining (?.) instead of non-null assertion (!)
    enabled: true
    tags: ["type-safety"]
